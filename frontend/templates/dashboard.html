
<!-- Dashboard widgets -->
<div class="widgets-column">
  <!-- Share of Voice Pie Chart -->
  <div class="widget-card">
    <h3>Share of Voice</h3>
  <canvas id="shareOfVoiceChart" ></canvas>
  </div>

  <!-- Word Cloud -->
  <div class="widget-card">
    <h3>Trending Topics</h3>
    <div id="wordCloud" ></div>
  </div>

  <!-- Trend Line -->
  <div class="widget-card">
    <h3>Trend Over Time</h3>
    <canvas id="trendLineChart"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-cloud/build/d3.layout.cloud.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  // Chart.js pie chart
  new Chart(document.getElementById('shareOfVoiceChart'), {
    type: 'pie',
    data: {
      labels: {{ share_of_voice.labels | tojson | safe }},
      datasets: [{
        label: 'Mentions',
        data: {{ share_of_voice.data | tojson | safe }},
        backgroundColor: ['#4F46E5', '#22D3EE', '#FB923C'],
      }]
    }
  });

  // Chart.js line chart
  new Chart(document.getElementById('trendLineChart'), {
    type: 'line',
    data: {
      labels: {{ trend_data.labels | tojson | safe }},
      datasets: [{
        label: 'Mentions Over Time',
        data: {{ trend_data.data | tojson | safe }},
        borderColor: '#4F46E5',
        tension: 0.2,
        fill: false,
      }]
    }
  });

  // Word Cloud
  const words = {{ wordcloud_data | tojson | safe }};
  d3.layout.cloud()
    .size([300, 250])
    .words(words.map(d => ({ text: d.text, size: d.size })))
    .padding(5)
    .rotate(() => ~~(0.5) * 90)
    .fontSize(d => d.size)
    .on("end", draw)
    .start();

  function draw(words) {
    d3.select("#wordCloud").append("svg")
      .attr("width", 300)
      .attr("height", 250)
      .append("g")
      .attr("transform", "translate(150,125)")
      .selectAll("text")
      .data(words)
      .enter().append("text")
      .style("font-size", d => d.size + "px")
      .style("fill", "#4F46E5")
      .attr("text-anchor", "middle")
      .attr("transform", d =>
        `translate(${d.x},${d.y})rotate(${d.rotate})`
      )
      .text(d => d.text);
  }
});
</script>